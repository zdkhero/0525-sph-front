# å°šå“æ±‡ç¬¬ 4 å¤©



## 1. Search ç»„ä»¶é™æ€å±•ç¤º



**æ€è·¯åˆ†æï¼š**



å¤åˆ¶æˆ‘ä»¬æå‰å‡†å¤‡å¥½çš„`Search`é™æ€ç»„ä»¶åˆ°è‡ªå·±çš„é¡¹ç›®å½“ä¸­å³å¯

`SearchSelector`ç»„ä»¶æ˜¯`Search`ç»„ä»¶çš„ä¸€ä¸ªå­ç»„ä»¶ï¼Œçˆ¶å­å…³ç³»ã€‚

<img src="./images/4-1 search.png" style="zoom:60%;" />



**å®ç°æ­¥éª¤ï¼š**

**è½åœ°ä»£ç ï¼š**







## 2.  å‡†å¤‡æœç´¢å‚æ•°



**æ€è·¯åˆ†æï¼š**



æœç´¢éœ€è¦çš„å‚æ•°å¾ˆå¤šï¼Œä¸”å¥½å¤šåœ°æ–¹éƒ½ç”¨ï¼Œæ‰€ä»¥åœ¨`Search`ç»„ä»¶çš„`data`ä¸­å‡†å¤‡å¥½ä¸€ä¸ªå‚æ•°å¯¹è±¡ã€‚ å¼ºçƒˆæ¨èè¿™æ ·åšï¼



**è½åœ°ä»£ç ï¼š**

```js
data() {	
  return {		
    //æœç´¢å‚æ•°		
    searchParams:{			
      category1Id:'', //ä¸€çº§åˆ†ç±»id(å¯é€‰å‚æ•°)		
      category2Id:'', //äºŒçº§åˆ†ç±»id(å¯é€‰å‚æ•°)		
      category3Id:'', //ä¸‰çº§åˆ†ç±»id(å¯é€‰å‚æ•°)			
      categoryName:'', //åˆ†ç±»å(å¯é€‰å‚æ•°)			
      keyword:'', //å…³é”®è¯(å¯é€‰å‚æ•°)		
      props:[], //å•†å“å±æ€§(å¯é€‰å‚æ•°)			
      trademark:'', //å“ç‰Œ(å¯é€‰å‚æ•°)				
      order:'', //æ’åº(å¯é€‰å‚æ•°)			
      pageNo:1, //å½“å‰é¡µç ï¼ˆå¿…é€‰é¡¹ï¼ï¼ï¼ï¼ï¼‰			
      pageSize:10 //æ¯é¡µå±•ç¤ºå¤šå°‘æ¡ï¼ˆå¿…é€‰é¡¹ï¼ï¼ï¼ï¼ï¼‰			
    }	
  }
}
```









## 3. Searchç»„ä»¶æ¥æ”¶å‚æ•°



**æ€è·¯åˆ†æï¼š**



æ— è®ºæ˜¯ç‚¹å‡»**åˆ†ç±»**ï¼Œè¿˜æ˜¯ç‚¹å‡»**æœç´¢**ï¼Œ`Search`ç»„ä»¶éƒ½éœ€è¦æ¥æ”¶è·¯ç”±å‚æ•°ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œèƒ½å¤Ÿå¯¹å‚æ•°è¿›è¡Œæ¥æ”¶ ï¼Ÿ



1. `mounted` é’©å­å‡½æ•° ï¼Ÿ
2. `updated` é’©å­å‡½æ•° ï¼Ÿ
3. `watch` ä¾¦å¬å™¨ ï¼Ÿ



æ³¨æ„ï¼š

1. ä¸èƒ½åœ¨`mounted`é’©å­ä¸­æ¥æ”¶å‚æ•°ï¼Œå› ä¸ºåˆæ¬¡å±•ç¤ºæ—¶æ˜¯ç»„ä»¶æŒ‚è½½ï¼Œä»¥åä¼ å‚æ‰æ˜¯ç»„ä»¶æ›´æ–°ã€‚

 	2. å¦‚æœæ•°æ®åœ¨é¡µé¢ä¸­ä½¿ç”¨äº†ï¼Œæ¨¡æ¿æ”¹å˜ä¼šè§¦å‘é’©å­å‡½æ•°ï¼Œåœ¨ `updated` é’©å­ä¸­èƒ½æ¥æ”¶å‚æ•°ï¼Œå¦åˆ™æ¥æ”¶ä¸åˆ°å‚æ•°
 	3. `watch` ä¾¦å¬å™¨ ï¼Œå¯ä»¥â— å…¶å® `vm`ã€`vc` ä¸­çš„æ•°æ®éƒ½èƒ½å¤Ÿè¢« `watch` æ£€æµ‹åˆ°



> ğŸ“Œ Tipï¼š
>
> â€‹	æˆ‘ä»¬å¯¹ `$route` çš„ç›‘å¬ï¼Œä¸éœ€è¦æ·»åŠ  `deep` å±æ€§ï¼Œä¸ºä»€ä¹ˆ ï¼Ÿ
>
> â€‹    å› ä¸ºæ¯æ¬¡è·³è½¬è·¯ç”±ï¼Œäº§ç”Ÿçš„éƒ½æ˜¯ä¸€ä¸ªæ–°çš„ `$route` å¯¹è±¡





**å®ç°æ­¥éª¤ï¼š**



1. åœ¨ `search` ç»„ä»¶ä¸­å®šä¹‰ `watch`
2. åœ¨ `watch` ä¸­å¯¹ `$route` è¿›è¡Œç›‘å¬



**è½åœ°ä»£ç ï¼š**

```js
watch:{	
  $route:{		
    // ç«‹å³ç›‘è§†ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©ç¬¬ä¸€æ¬¡æœç´¢çš„æ—¶å€™ï¼Œå¯ä»¥æ‹¿åˆ°å‚æ•°ã€‚
    immediate:true,
    // æ­¤å¤„çš„valueæ˜¯è°ï¼Ÿ â€”â€” æ˜¯$routeçš„æ–°å€¼ï¼ˆç›‘è§†çš„æ˜¯è°ï¼Œhandlerå¾—åˆ°çš„å°±æ˜¯è°çš„æ–°å€¼ï¼‰
    handler(value){	
      console.log(value.query)		
    }	
  }
}
```







## 4. Searchç»„ä»¶åˆå¹¶å‚æ•°



**æ€è·¯åˆ†æï¼š**



åœ¨ä½¿ç”¨ watch ç›‘å¬åˆ°ä¼ é€’çš„æ•°æ®åï¼Œéœ€è¦å°†ä¼ é€’çš„æ•°æ®èµ‹å€¼ç»™ data ä¸­çš„çŠ¶æ€ï¼Œå®ç°æ–¹å¼æœ‰ï¼š



1. é€ä¸ªèµ‹å€¼								â†’ ä»£ç å†—ä½™ã€ä¸ä¼˜é›…
2. è§£æ„èµ‹å€¼                          â†’ ä¸æ˜¯å¾ˆç¾è§‚
3. Object.assgin() èµ‹å€¼        â†’ ç›¸å¯¹æ¥è¯´æ¯”è¾ƒæ¸…æ™°



ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼Œä¾‹å¦‚ï¼šå½“æˆ‘ä»¬ç‚¹å‡» ä¸€çº§åˆ†ç±» æ—¶ï¼Œéœ€è¦äºŒçº§ã€ä¸‰çº§è¿›è¡Œé‡ç½®ï¼Œå…¶ä»–å‚æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„



<img src="./images/4-2 åˆå¹¶å‚æ•°.png" style="zoom:70%; border: 1px solid #ccc" />





**å®ç°æ­¥éª¤ï¼š**



1. åœ¨ watch æ–¹æ³•ä¸­ï¼Œæ¥æ”¶åˆ°æ›´æ–°åçš„æ•°æ®
2. ä½¿ç”¨ æ‹“å±•è¿ç®—ç¬¦ å’Œ Object.assign åˆå¹¶å‚æ•°



**è½åœ°ä»£ç ï¼š**

```js
watch: {
  $route: {
    handler(route) {
      // éœ€è¦é‡ç½®çš„ query å‚æ•°æ•°æ®
      const resetObj = {
        category1Id: '',
        category2Id: '',
        category3Id: '',
        categoryName: '',
        keyword: ''
      }
      
      // ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦åˆå¹¶å‚æ•°
      // this.searchParams = { ...this.searchParams, ...resetObj, ...route.query }

      // ä½¿ç”¨ Object.assign åˆå¹¶å‚æ•°
      // å°†éœ€è¦é‡ç½®çš„ query å‚æ•°æ•°æ®ï¼Œå¹¶å°†æœ€æ–°å‚æ•°åˆå¹¶è¿›å»
      Object.assign(this.searchParams, resetObj, route.query)
    },
    immediate: true
  }
}
```









## 5. å‘èµ·æœç´¢è¯·æ±‚



**æ€è·¯åˆ†æï¼š**



å‚æ•°å·²ç»ç»„ç»‡å®Œæ¯• ï¼Œä¸‹ä¸€æ­¥éœ€è¦ä½¿ç”¨å‚æ•°ï¼Œå‘èµ·è¯·æ±‚



**å®ç°æ­¥éª¤ï¼š**



1. å°è£…æœç´¢åŒºåŸŸçš„ API
2. è°ƒç”¨ APIï¼Œä¼ å…¥å‚æ•°ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦è·å–æˆåŠŸ



**è½åœ°ä»£ç ï¼š**



1. å°è£…æœç´¢åŒºåŸŸçš„ API

   ```js
   // å¯¼å…¥å°è£…çš„ç½‘ç»œè¯·æ±‚å·¥å…· request.js
   import request from '@/utils/request'
   
   /**
    * @description æœç´¢ç»“æœ
    * @param {*} params
    * @returns
    */
   export const reqSearchInfo = (params) => request.post('/api/list', params)
   
   ```

   

2. è°ƒç”¨ APIï¼Œä¼ å…¥å‚æ•°ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦è·å–æˆåŠŸ

   ```js
   import { reqSearchInfo } from '@/api/search'
   
   watch: {
     $route: {
       handler(route) {
         // éœ€è¦é‡ç½®çš„ query å‚æ•°æ•°æ®
         const resetObj = {
           category1Id: '',
           category2Id: '',
           category3Id: '',
           categoryName: '',
           keyword: ''
         }
         
         // ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦åˆå¹¶å‚æ•°
         // this.searchParams = { ...this.searchParams, ...resetObj, ...route.query }
   
         // ä½¿ç”¨ Object.assign åˆå¹¶å‚æ•°
         // å°†éœ€è¦é‡ç½®çš„ query å‚æ•°æ•°æ®ï¼Œå¹¶å°†æœ€æ–°å‚æ•°åˆå¹¶è¿›å»
         Object.assign(this.searchParams, resetObj, route.query)
           
         const res = await reqSearchInfo(this.searchParams)
         console.log(res)
       },
       immediate: true
     }
   }
   ```







## 6. æœç´¢ç»“æœå­˜å…¥ vuex



**æ€è·¯åˆ†æï¼š**



> å‘èµ·æœç´¢è¯·æ±‚ï¼ŒæŒ‰ç…§ç›®å‰çš„åšæ³•æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç»ƒä¹ ä¸‹ `Vuex`



**å®ç°æ­¥éª¤ï¼š**



1. æ–°å»º `search/index.js` æ–‡ä»¶ï¼Œç”¨æ¥ç®¡ç†æœç´¢åŒºåŸŸçš„çŠ¶æ€
2. åœ¨ `state` ä¸­å®šæ¥¼å±‚çŠ¶æ€
3. å®šä¹‰ `actions` æ–¹æ³•ï¼Œå¤„ç†å¼‚æ­¥çš„é€»è¾‘
4. å®šä¹‰ `mutations` æ–¹æ³•ï¼Œå¯¹æ•°æ®è¿›è¡Œå˜æ›´
5. åœ¨ç»„ä»¶ä¸­é€šè¿‡ `dispatch` æˆ–è€… `mapActions` è°ƒç”¨ `action` æ–¹æ³•



**è½åœ°ä»£ç ï¼š**



1. æ–°å»º `search/index.js` æ–‡ä»¶ï¼Œç”¨æ¥ç®¡ç†æœç´¢åŒºåŸŸçš„çŠ¶æ€

2. åœ¨ `state` ä¸­å®šä¹‰çŠ¶æ€ï¼Œå®šä¹‰ `actions` æ–¹æ³•ï¼Œå¤„ç†å¼‚æ­¥çš„é€»è¾‘ï¼Œå®šä¹‰ `mutations` æ–¹æ³•ï¼Œå¯¹æ•°æ®è¿›è¡Œå˜æ›´

   ```js
   import { reqSearchInfo } from '@/api/search'
   
   const state = {
     searchInfo: {} // å­˜å‚¨æœç´¢ç»“æœ
   }
   
   const mutations = {
     saveSearchInfo(state, value) {
       state.searchInfo = value
     }
   }
   
   const actions = {
     // ä¸“é—¨ç”¨äºæœç´¢
     async getSearchInfo({ commit }, searchParams) {
       const result = await reqSearchInfo(searchParams)
   
       if (result.code === 200) {
         commit('saveSearchInfo', result.data)
       } else {
         alert(result.message)
       }
     }
   }
   
   const getters = {}
   
   export default {
     namespaced: true,
     state,
     getters,
     mutations,
     actions
   }
   
   ```

   

3. åœ¨ç»„ä»¶ä¸­é€šè¿‡ `dispatch` æˆ–è€… `mapActions` è°ƒç”¨ `action` æ–¹æ³•

   ```js
   this.$store.dispatch('search/getSearchInfo', this.searchParams)
   ```







## 7. Search ç»„ä»¶å±•ç¤ºæ•°æ®



**æ€è·¯åˆ†æï¼š**



<img src="./images/4-2 å•†å“åˆ—è¡¨.png" style="zoom:80%; border: 1px solid #ccc" />



å±•ç¤ºå•†å“åˆ—è¡¨ï¼Œå…ˆä¸å®ç°ï¼šé¢åŒ…å±‘ã€æœç´¢é€‰æ‹©å™¨  è¿™äº›åŠŸèƒ½ã€‚



**å®ç°æ­¥éª¤ï¼š**



1. `goodsList`æ˜¯å•†å“åˆ—è¡¨ï¼Œä½¿ç”¨`mapState`è¯»å–`goodsList`
2. ä½¿ç”¨`v-for`æ ¹æ®`goodsList`éå†ç”Ÿæˆå•†å“åˆ—è¡¨



**è½åœ°ä»£ç ï¼š**

1. `goodsList`æ˜¯å•†å“åˆ—è¡¨ï¼Œä½¿ç”¨`mapState`è¯»å–`goodsList`

   ```js
   computed: {
     ...mapState({ goodsList: (state) => state.search.searchInfo.goodsList })
   }
   ```

   

2. ä½¿ç”¨`v-for`æ ¹æ®`goodsList`éå†ç”Ÿæˆå•†å“åˆ—è¡¨

   ```html
   <!-- å•†å“åˆ—è¡¨ -->
   <div class="goods-list">
     <ul class="yui3-g">
       <li class="yui3-u-1-5" v-for="good in goodsList" :key="good.id">
         <div class="list-wrap">
           <div class="p-img">
             <a href="item.html" target="_blank">
               <img :src="good.defaultImg" />
             </a>
           </div>
           <div class="price">
             <strong>
               <em>Â¥</em>
               <i>{{ good.price }}</i>
             </strong>
           </div>
           <div class="attr">
             <a target="_blank" href="item.html" v-html="good.title" />
           </div>
           <div class="commit">
             <i class="command">å·²æœ‰<span>2000</span>äººè¯„ä»·</i>
           </div>
         </div>
       </li>
     </ul>
   </div>
   ```

   







## 8. SearchSelectorå±•ç¤ºæ•°æ®



**æ€è·¯åˆ†æï¼š**



<img src="./images/4-3 å“ç‰Œå±æ€§åˆ—è¡¨.png" style="zoom:80%; border: 1px solid #ccc" />



åœ¨ `SearchSelector` ç»„ä»¶ä¸­ï¼Œä» `Vuex` è¯»å– å±æ€§åˆ—è¡¨ å’Œ å“ç‰Œåˆ—è¡¨ æ•°æ®ï¼Œå…¶ä¸­ `attrsList`æ˜¯å±æ€§åˆ—è¡¨æ•°æ®ï¼Œ`trademarkList`æ˜¯å“ç‰Œåˆ—è¡¨æ•°æ®



**å®ç°æ­¥éª¤ï¼š**



1. ä½¿ç”¨ `mapState`è¯»å–`attrsList` å’Œ `trademarkList` æ•°æ®
2. ä½¿ç”¨`v-for`æ ¹æ®`attrsList` å’Œ `trademarkList` æ•°æ®æ¸²æŸ“é¡µé¢



**è½åœ°ä»£ç ï¼š**



1. ä½¿ç”¨ `mapState`è¯»å–`attrsList` å’Œ `trademarkList` æ•°æ®

   ```vue
   <script>
   import { mapState } from 'vuex'
   export default {
     name: 'SearchSelector',
     computed: {
       ...mapState({
         trademarkList: (state) => state.search.searchInfo.trademarkList,
         attrsList: (state) => state.search.searchInfo.attrsList
       })
     }
   }
   </script>
   ```

   

2. ä½¿ç”¨`v-for`æ ¹æ®`attrsList` å’Œ `trademarkList` æ•°æ®æ¸²æŸ“é¡µé¢

   ```vue
   <template>
     <!--æœç´¢é€‰æ‹©å™¨-->
     <div class="clearfix selt">
       <div class="type-wrap logo">
         <div class="fl key brand">å“ç‰Œ</div>
         <div class="value logos">
           <!-- å“ç‰Œåˆ—è¡¨åŒº -->
           <ul class="logo-list">
             <!-- éå†ç”Ÿæˆå“ç‰Œåˆ—è¡¨ -->
             <li v-for="trademark in trademarkList" :key="trademark.tmId">
               {{ trademark.tmName }}
             </li>
           </ul>
         </div>
       </div>
   
       <!-- å•†å“å±æ€§åŒº -->
       <!-- éå†ç”Ÿæˆæ¯ä¸ªå±æ€§å¯¹åº”çš„div -->
       <div class="type-wrap" v-for="attrs in attrsList" :key="attrs.attrId">
         <!-- å±æ€§åï¼ˆé¢œè‰²ã€é‡é‡ã€å±å¹•å°ºå¯¸....ï¼‰ -->
         <div class="fl key">{{ attrs.attrName }}</div>
         <div class="fl value">
           <ul class="type-list">
             <!-- éå†å±æ€§å€¼ï¼ˆé»„è‰²ã€ç»¿è‰²ã€æ©™è‰²ã€200gã€215gã€6.5å¯¸ã€7.0å¯¸ï¼‰ -->
             <li v-for="(attrValue, index) in attrs.attrValueList" :key="index">
               <a>{{ attrValue }}</a>
             </li>
           </ul>
         </div>
         <div class="fl ext"></div>
       </div>
     </div>
   </template>
   ```







## 9. é¢åŒ…å±‘-å±•ç¤ºåˆ†ç±»å



**æ€è·¯åˆ†æï¼š**



æ€è€ƒï¼šé¢åŒ…å±‘å¯ä»¥å‘ˆç°å“ªäº›å†…å®¹â“

å›ç­”ï¼š`åˆ†ç±»å`ã€`å…³é”®å­—`ã€`å“ç‰Œ`ã€`å•†å“å±æ€§`



è¿™ä¸€å°ç»“èŠ‚å…ˆå‘ˆç°åˆ†ç±»åï¼Œå¯ä»¥åˆ©ç”¨ `Search`  ç»„ä»¶ä¸­å£°æ˜çš„ `searchParams` æŸ¥è¯¢å‚æ•°ä¸­çš„ `categoryName` å±•ç¤º



**å®ç°æ­¥éª¤ï¼š**



1. ä»`searchParams`ä¸­å¾—åˆ°`categoryName`ï¼Œå±•ç¤ºåˆ°é¡µé¢
2. ä½¿ç”¨`v-show`åšåˆ¤æ–­ï¼š `v-show="searchParams.categoryName"` 



**è½åœ°ä»£ç ï¼š**

```vue
<!-- é¢åŒ…å±‘_åˆ†ç±»å -->
<li class="with-x" v-show="searchParams.categoryName">	
  {{searchParams.categoryName}}	
  <i>Ã—</i>
</li>
```









## 10. é¢åŒ…å±‘-ç§»é™¤åˆ†ç±»å



**æ€è·¯åˆ†æï¼š**



å½“ç‚¹å‡»åˆ†ç±»åé¢çš„ `x` æ—¶å€™ï¼Œéœ€è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š

1. æµè§ˆå™¨çš„è·¯å¾„ä¸­ï¼Œè¦åˆ é™¤ `categoryName`ã€`category?Id`
2. å°† `searchParams` ä¸­çš„ `categoryName`ã€`category?Id` é‡ç½®ä¸ºç©º
3. è®©  `categoryName`ã€`category?Id` ä¸ºç©ºï¼Œéšåé‡æ–°å‘ä¸€æ¬¡è¯·æ±‚è·å–å…¨éƒ¨çš„æ•°æ®



> ğŸ“Œ Tipï¼š
>
> â€‹	æ³¨æ„ï¼šç›®å‰åªæ˜¯å»é™¤ï¼šåˆ†ç±»åã€åˆ†ç±»ç¼–å·ï¼Œå…³é”®è¯ä¸è¦åˆ é™¤



**å®ç°æ­¥éª¤ï¼š**



1. ç»™åˆ†ç±»åé¢çš„ `x` ç»‘å®šåˆ é™¤äº‹ä»¶
2. åˆ é™¤æµè§ˆå™¨è·¯å¾„ã€å’Œ  `searchParams` ä¸­çš„ `categoryName`ã€`category?Id`



**è½åœ°ä»£ç ï¼š**

```js
methods: {
  removeCategoryName() {
    // å°è¯•è·å–å…³é”®è¯
    const { keyword } = this.$route.query
    // é‡æ–°è·³è½¬è·¯ç”±
    this.$router.push({
      path: '/search',
      query: { keyword }
    })
  }
}
```







## 11. é¢åŒ…å±‘-å±•ç¤ºå…³é”®è¯



**æ€è·¯åˆ†æï¼š**



<img src="./images/4-5 å±•ç¤ºå…³é”®å­—.png" style="zoom:80%; border: 1px solid #ccc" />



éœ€è¦å°†ç”¨æˆ·è¾“å…¥çš„å…³é”®å­—å±•ç¤ºåˆ°é¢åŒ…å±‘åŒºåŸŸï¼Œæ­¤åŠŸèƒ½å’Œåˆ†ç±»åŠŸèƒ½ä¸€è‡´ï¼Œç›´æ¥å¤åˆ¶ç»“æ„ï¼Œæ›´æ¢å…³é”®å­—å³å¯

```html
<ul class="fl sui-tag">
  <!-- åˆ†ç±»åé¢åŒ…å±‘ -->
  <li class="with-x" v-show="searchParams.categoryName">
    {{ searchParams.categoryName }} <i @click="removeCategoryName">Ã—</i>
  </li>

  <!-- å…³é”®å­—é¢åŒ…å±‘ -->
  <li class="with-x" v-show="searchParams.keyword">
    {{ searchParams.keyword }} <i @click="removeKeyword">Ã—</i>
  </li>
</ul>
```



<img src="./images/4-4 é«˜äº®å…³é”®å­—.png" style="zoom:80%; border: 1px solid #ccc" />



å¦‚ä¸Šå›¾ï¼Œå½“æˆ‘ä»¬æœç´¢å¯¹åº”çš„å…³é”®å­—ï¼Œå‘ç°å•†å“çš„æ ‡é¢˜å‡ºç°äº†å¯¹åº”çš„ `HTML` æ ‡ç­¾ï¼Œè¿™æ˜¯åç«¯ç»™å…³é”®å­—æ·»åŠ çš„é«˜äº®çš„æ•ˆæœã€‚é‚£ä¹ˆå¦‚ä½•æ­£ç¡®çš„æ¸²æŸ“é«˜äº®çš„ `HTML` æ ‡ç­¾å‘¢



ç­”ï¼š`v-html`



**å®ç°æ­¥éª¤ï¼š**



ä½¿ç”¨ `v-html` æ›¿æ¢ä¹‹å‰çš„æ¨¡æ¿å­—ç¬¦ä¸²å†™æ³•ï¼Œè§£æ `HTML` æ ‡ç­¾ 



**è½åœ°ä»£ç ï¼š**

```html
<ul class="fl sui-tag">
  <!-- åˆ†ç±»åé¢åŒ…å±‘ -->
  <li class="with-x" v-show="searchParams.categoryName">
    {{ searchParams.categoryName }} <i @click="removeCategoryName">Ã—</i>
  </li>

  <!-- å…³é”®å­—é¢åŒ…å±‘ -->
  <li class="with-x" v-show="searchParams.keyword">
    {{ searchParams.keyword }} <i @click="removeKeyword">Ã—</i>
  </li>
</ul>
```



```html
<div class="attr">
  <!-- <a target="_blank" href="item.html"> {{ good.title }} </a> -->
  
  <a target="_blank" href="item.html" v-html="good.title" />
</div>
```









## 12. é¢åŒ…å±‘-ç§»é™¤å…³é”®è¯



**æ€è·¯åˆ†æï¼š**



<img src="./images/4-5 åˆ é™¤å…³é”®å­—.png" style="zoom:80%; border: 1px solid #ccc" />



å½“ç”¨æˆ·ç‚¹å‡»åˆ é™¤å…³é”®å­—çš„æ—¶å€™ï¼Œåº”è¯¥å°†å…³é”®å­—ç§»é™¤ï¼ŒåŒæ—¶è¿˜éœ€è¦åšä»¥ä¸‹å¤„ç†

1. æµè§ˆå™¨çš„è·¯å¾„ä¸­ï¼Œè¦ä¿ç•™ `categoryName`ã€`category?Id`
2. å°† `searchParams` ä¸­çš„ `keyword` é‡ç½®ä¸ºç©º
3. å°†æµè§ˆå™¨ä¸­çš„  `keyword` æ¸…é™¤ï¼Œéšåé‡æ–°å‘ä¸€æ¬¡è¯·æ±‚è·å–å…¨éƒ¨çš„æ•°æ®



å®ç°æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š



1. delete åˆ é™¤ keywordï¼Œ<font color="red">æ³¨æ„æ­¤æ–¹æ³•æœ‰å‘</font>

   ```js
   // é¢åŒ…å±‘-ç§»é™¤å…³é”®å­—
   removeKeyword() {
     const { query } = this.$route // å‡å¦‚ï¼šæ“ä½œçš„åœ°å€æ˜¯ 0x11
     delete query.keyword			// ä» 0x11 è¿™ä¸ªåœ°å€ä¸­åˆ é™¤æ•°æ®
   
     this.$router.push({
       path: '/search',
       query						// å°† 0x11 è¿™ä¸ªåœ°å€é‡ç½®èµ‹å€¼ç»™ 0x11ï¼Œè·¯ç”±ç›‘å¬ä¸åˆ°æ”¹å˜
     })
   }
   ```

   

2. åˆ©ç”¨æ·±æ‹·è´ <font color="red">å¯è¡Œ</font>

   ```js
   // é¢åŒ…å±‘-ç§»é™¤å…³é”®å­—
   removeKeyword() {
     const { query } = this.$route
     const newQuery = JSON.parse(JSON.stringify(query))
   
     delete newQuery.keyword
   
     this.$router.push({
       path: '/search',
       query: newQuery
     })
   }
   ```

   

3. åˆ©ç”¨å±•å¼€è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œèµ‹å€¼ç»™ queryï¼Œ<font color="red">å¯è¡Œï¼Œæ¨è</font>

   ```js
   // é¢åŒ…å±‘-ç§»é™¤å…³é”®å­—
   removeKeyword() {
     const { keyword, ...newQuery } = this.$route.query
   
     console.log(newQuery)
     this.$router.push({
       path: '/search',
       query: newQuery
     })
   }
   ```

   

4. å°† keyword è®¾ç½®ä¸º undefinedï¼Œ<font color="red">å¯è¡Œï¼Œæ¨è</font>

   ```js
   // é¢åŒ…å±‘-ç§»é™¤å…³é”®å­—
   removeKeyword() {
     const { query } = this.$route
   
     this.$router.push({
       path: '/search',
       query: {
         ...query,
         keyword: undefined
       }
     })
   }
   ```

   



**å®ç°æ­¥éª¤ï¼š**

â€‹	å‚è€ƒåˆ†æ 3 æˆ– 4

**è½åœ°ä»£ç ï¼š**

  å‚è€ƒåˆ†æ 3 æˆ– 4







## 13. å°ç»†èŠ‚å®Œå–„



**ä¸šåŠ¡éœ€æ±‚ï¼š**



<img src="./images/4-6 å®Œå–„.png" style="zoom:80%; border: 1px solid #ccc" />



1. å½“ç”¨æˆ·ç§»é™¤å…³é”®å­—ä»¥åï¼Œéœ€è¦å°†è¾“å…¥æ¡†ä¸­è¾“å…¥çš„å…³é”®å­—ä¹Ÿç§»é™¤
2. å½“ç”¨æˆ·ç‚¹å‡» logo çš„æ—¶å€™ï¼Œéœ€è¦å°†è¾“å…¥æ¡†ä¸­è¾“å…¥çš„å…³é”®å­—ä¹Ÿç§»é™¤
3. ç‚¹å‡»åˆ†ç±»ï¼Œéšè—å¯¼èˆªç»„ä»¶



**æ€è·¯åˆ†æï¼š**



ç¬¬ 1 ä¸ªéœ€æ±‚ï¼š

è¾“å…¥æ¡†åœ¨ `Header` ç»„ä»¶ä¸­ï¼Œç§»é™¤å…³é”®å­—åŒºåŸŸåœ¨ `Search` ç»„ä»¶ä¸­ï¼Œæƒ³å®ç°ä¸¤ä¸ªç»„ä»¶çš„é€šä¿¡ï¼Œæœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–¹å¼ï¼š

1. `Vuex`
2. äº‹ä»¶æ€»çº¿



å¦‚æœä½¿ç”¨ `Vuex` ï¼Œæ”¹åŠ¨æ¯”è¾ƒå¤§ï¼Œè¿™é‡Œä½¿ç”¨ äº‹ä»¶æ€»çº¿



ç¬¬ 2 ä¸ªéœ€æ±‚ï¼š

ç»™ img ç»‘å®šäº‹ä»¶ï¼Œç‚¹å‡»åå°† keyword é‡ç½®ä¸ºç©º

```html
<img @click="keyword = ''" src="./images/logo.png" alt="" />
```





ç¬¬ 3 ä¸ªéœ€æ±‚ï¼š

ç‚¹å‡»åˆ†ç±»ï¼Œéšè—å¯¼èˆªç»„ä»¶

```js
// åˆ°æœç´¢é¡µé¢
toSearch(e) {
  // è·å–åˆ°ç‚¹å‡»åˆ†ç±»çš„ï¼šåˆ†ç±»çº§åˆ«ã€åˆ†ç±»ç¼–å·ã€åˆ†ç±»åç§°
  // coding......
  
  this.isShowNav = false
}
```







**å®ç°æ­¥éª¤ï¼š**



1. åœ¨å…¥å£æ–‡ä»¶ `main.js` ä¸­ï¼Œå®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿
2. åœ¨`Search`çš„`removeKeyword`æ–¹æ³•ä¸­é€šè¿‡ `$emit`è§¦å‘äº‹ä»¶
3. åœ¨`Header`ç»„ä»¶çš„ `mounted` é’©å­å‡½æ•°ä¸­é€šè¿‡ `$on` ç›‘å¬äº‹ä»¶
4. åœ¨`Header`ç»„ä»¶çš„ `beforeDestroy` é’©å­å‡½æ•°ä¸­å¯¹äº‹ä»¶é”€æ¯



**è½åœ°ä»£ç ï¼š**

1. åœ¨å…¥å£æ–‡ä»¶ `main.js` ä¸­ï¼Œå®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿

   ```js
   new Vue({
     router,
     store,
     // æŒ‚è½½äº‹ä»¶æ€»çº¿
     beforeCreate() {
       Vue.prototype.$eventBus = this
     },
     render: (h) => h(App)
   }).$mount('#app')
   
   ```

   

2. åœ¨`Search`çš„`removeKeyword`æ–¹æ³•ä¸­é€šè¿‡ `$emit`è§¦å‘äº‹ä»¶

   ```js
   // é¢åŒ…å±‘-ç§»é™¤å…³é”®å­—
   removeKeyword() {
    // coding......
   
     // æ¸…ç©ºæœç´¢æ¡†é‡Œçš„å…³é”®è¯
     this.$eventBus.$emit('clear-keyword')
   }
   ```

   

3. åœ¨`Header`ç»„ä»¶çš„ `mounted` é’©å­ä¸­é€šè¿‡ `$on` ç›‘å¬äº‹ä»¶ï¼Œåœ¨ `beforeDestroy` é’©å­ä¸­å¯¹äº‹ä»¶é”€æ¯

   ```js
   mounted() {
     // Headerç»„ä»¶ä¸€æŒ‚è½½å°±ç»™$busç»‘å®šäº†ä¸€ä¸ªclear-keywordäº‹ä»¶ï¼Œç”¨äºæ¸…ç©ºå…³é”®è¯
     this.$eventBus.$on('clear-keyword', () => {
       this.keyword = ''
     })
   },
   beforeDestroy() {
     // Headerç»„ä»¶å°†è¦é”€æ¯å‰ï¼Œè§£ç»‘$busä¸Šçš„clear-keyword
     this.$eventBus.$off('clear-keyword')
   }
   ```

   ```html
   <img @click="keyword = ''" src="./images/logo.png" alt="" />
   ```

   









**æ€è·¯åˆ†æï¼š**

**å®ç°æ­¥éª¤ï¼š**

**è½åœ°ä»£ç ï¼š**