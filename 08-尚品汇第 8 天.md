# å°šå“æ±‡ç¬¬ 8 å¤©



## 1. Element-ä»‹ç»

<img src="./images/8-1 element.png" style="zoom:80%; border: 1px solid #409eff" />





Element ç”±é˜¿é‡Œå·´å·´é›†å›¢-é¥¿äº†ä¹ˆå‰ç«¯å›¢é˜Ÿè¿›è¡Œå¼€å‘

Element ä¸€å¥—ä¸ºå¼€å‘è€…ã€è®¾è®¡å¸ˆå’Œäº§å“ç»ç†å‡†å¤‡çš„åŸºäº Vue 2.0 çš„åå°ç®¡ç†ç³»ç»Ÿç»„ä»¶åº“ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ çš„ç½‘ç«™å¿«é€Ÿæˆå‹ï¼Œéšç€ Vue 3.0 çš„å‘å¸ƒï¼ŒElement å›¢é˜Ÿå‘å¸ƒäº† Element Plusï¼Œä¸ºäº†å¸®åŠ©å¼€å‘è€…æ›´å¥½çš„è¿›è¡Œ Vue 3.0 é¡¹ç›®



1. [Element-å®˜æ–¹ç½‘å€](https://element.eleme.cn/#/zh-CN)
2. [Element Plus-å®˜æ–¹ç½‘å€](https://element-plus.gitee.io/#/zh-CN)







## 2. Element-åŸºæœ¬ä½¿ç”¨



**çŸ¥è¯†ç‚¹ï¼š**

UI æ¡†æ¶çš„ä½¿ç”¨æµç¨‹éƒ½æ˜¯å…·æœ‰é€šç”¨æ€§ï¼Œä¸åŒçš„ UI æ¡†æ¶ä½¿ç”¨æµç¨‹å¯ä»¥ç›¸äº’å€Ÿé‰´

åªä¸è¿‡ä¸åŒçš„ UI æ¡†æ¶ æä¾›çš„ä½¿ç”¨ æ–¹æ³•å’Œ API æ˜¯ä¸åŒçš„ã€‚



ä¸€èˆ¬ UI æ¡†æ¶çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š

1.  ä½¿ç”¨ `Vue Cli` åˆ›å»ºé¡¹ç›®
2.  æŸ¥é˜… `å®˜æ–¹æ–‡æ¡£` â†’ `å®‰è£…` â†’` å¿«é€Ÿä¸Šæ‰‹`
3.  å‚è€ƒæ–‡æ¡£è¿›è¡Œå¯¼å…¥å’Œå¼€å‘å³å¯



<img src="./images/8-2 element.png" style="zoom:80%; border: 1px solid #ddd" />

<img src="./images/8-3 element.png" style="zoom:80%; border: 1px solid #ddd" />









## 3. Element-æŒ‰éœ€åŠ è½½



**æ€è·¯åˆ†æï¼š**



Element é»˜è®¤åŠ è½½çš„æ–¹å¼ï¼Œä¼šåŠ è½½é¡¹ç›®ä¸­æ‰€æœ‰çš„ç»„ä»¶ï¼Œè¿™æ ·ä¼šé€ æˆé¡¹ç›®çš„ä½“ç§¯å¾ˆå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ æˆ‘ä»¬å¯ä»¥é…ç½®æŒ‰éœ€å¼•å…¥ï¼Œåªå¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œä»¥è¾¾åˆ°å‡å°é¡¹ç›®ä½“ç§¯çš„ç›®çš„ã€‚



[ç»„ä»¶æŒ‰éœ€å¼•å…¥ | Element](https://element.eleme.cn/#/zh-CN/component/quickstart#an-xu-yin-ru)



**å®ç°æ­¥éª¤ï¼š**



1. å®‰è£… `babel-plugin-component` æ’ä»¶
2. æŒ‰ç…§æ–‡æ¡£ä¿®æ”¹ `babel.config.js`
3. åœ¨ `src` ç›®å½•ä¸‹åˆ›å»º `plugins/element.js` æ–‡ä»¶ï¼Œå¯¼å…¥ `element` æ’ä»¶
4. åœ¨ `main.js` æ–‡ä»¶ä¸­å¯¼å…¥ `plugins/element.js` æ–‡ä»¶



**è½åœ°ä»£ç ï¼š**



1. åœ¨ `src` ç›®å½•ä¸‹åˆ›å»º `plugins/element.js` æ–‡ä»¶ï¼Œå¯¼å…¥ `element` æ’ä»¶

   ```js
   import Vue from 'vue'
   // å¯¼å…¥æ ·å¼
   import 'element-ui/lib/theme-chalk/index.css'
   
   // å¯¼å…¥éœ€è¦ä½¿ç”¨çš„ç»„ä»¶
   import { Button } from 'element-ui'
   
   // æ³¨å†Œç»„ä»¶
   Vue.use(Button)
   
   ```

   

2. åœ¨ `main.js` æ–‡ä»¶ä¸­å¯¼å…¥ `plugins/element.js` æ–‡ä»¶

   ```js
   // å¯¼å…¥ Element æ’ä»¶
   import './plugins/element.js'
   ```

   

3. åœ¨é¡µé¢ä¸­ä½¿ç”¨ `Button` ç»„ä»¶

   ```html
   <el-row>
     <el-button icon="el-icon-search" circle></el-button>
     <el-button type="primary" icon="el-icon-edit" circle></el-button>
     <el-button type="success" icon="el-icon-check" circle></el-button>
     <el-button type="info" icon="el-icon-message" circle></el-button>
     <el-button type="warning" icon="el-icon-star-off" circle></el-button>
     <el-button type="danger" icon="el-icon-delete" circle></el-button>
   </el-row>
   ```









## 4. Element-æç¤ºç»„ä»¶



**æ€è·¯åˆ†æï¼š**



`Element` ç»™æç¤ºç»„ä»¶ï¼Œéƒ½å¢åŠ äº†å…¨å±€çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ `plugins/element.js` æ–‡ä»¶ä¸­å¯¼å…¥å¯¹åº”çš„æç¤ºç»„ä»¶ï¼Œç„¶åæŒ‰ç…§ä»¥ä¸‹æ–¹æ³•é…ç½®åˆ° `Vue` çš„åŸå‹ä¸Šï¼Œå³å¯å°†æç¤ºç»„ä»¶å½“æˆæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨

```js
Vue.prototype.$loading = Loading.service;
Vue.prototype.$msgbox = MessageBox;
Vue.prototype.$alert = MessageBox.alert;
Vue.prototype.$confirm = MessageBox.confirm;
Vue.prototype.$prompt = MessageBox.prompt;
Vue.prototype.$notify = Notification;
Vue.prototype.$message = Message;
```





**å®ç°æ­¥éª¤ï¼š**



1. åœ¨  `plugins/element.js`  ä¸­å¯¼å…¥ç»„ä»¶
2. å°†ç»„ä»¶æŒ‰ç…§ `Element` æä¾›çš„æ–¹å¼æŒ‚è½½åˆ° `Vue` å…ƒåŸå‹ä¸Š
3. åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æç¤ºç»„ä»¶æ–¹æ³•



**è½åœ°ä»£ç ï¼š**



1. åœ¨  `plugins/element.js`  ä¸­å¯¼å…¥ç»„ä»¶

2. å°†ç»„ä»¶æŒ‰ç…§ `Element` æä¾›çš„æ–¹å¼æŒ‚è½½åˆ° `Vue` å…ƒåŸå‹ä¸Š

   ```js
   import Vue from 'vue'
   // å¯¼å…¥æ ·å¼
   import 'element-ui/lib/theme-chalk/index.css'
   
   // å¯¼å…¥éœ€è¦ä½¿ç”¨çš„ç»„ä»¶
   import { Message } from 'element-ui'
   
   
   Vue.prototype.$message = Message
   
   ```

   

3. åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æç¤ºç»„ä»¶æ–¹æ³•

   ```js
   this.$message('è¿™æ˜¯ä¸€ä¸ªå¼¹æ¡†ç»„ä»¶~~~')
   
   this.$message({
     message: 'è­¦å‘Šå“¦ï¼Œè¿™æ˜¯ä¸€æ¡è­¦å‘Šæ¶ˆæ¯',
     type: 'warning'
   })
   ```








## 5. æ³¨å†Œ-é™æ€ç»“æ„+æ”¶é›†æ•°æ®



**æ€è·¯åˆ†æï¼š**



1. å‡†å¤‡é™æ€ç»„ä»¶ï¼Œä»å‡†å¤‡å¥½çš„ç»„ä»¶ä¸­å¤åˆ¶ç™»å½•å’Œæ³¨å†Œç»„ä»¶ï¼Œå¯¹å·²ç»å­˜åœ¨çš„ç»„ä»¶è¿›è¡Œæ›¿æ¢
2. æ ¹æ®æ¥å£æ–‡æ¡£ï¼Œå‡†å¤‡æ³¨å†Œè¡¨å•éœ€è¦çš„æ•°æ®
3. é€šè¿‡ v-model å°†è¡¨å•å’Œæ•°æ®è¿›è¡Œç»‘å®š



å…ˆå°†ç»“æ„çš„ä¸­çš„éªŒè¯éƒ¨åˆ†è¿›è¡Œç§»é™¤ï¼Œåç»­åœ¨å®Œæˆæ ¡éªŒåŠŸèƒ½çš„å¼€å‘



**å®ç°æ­¥éª¤ï¼š**



1. å¤åˆ¶ç»“æ„æ›¿æ¢å·²æœ‰çš„ç»„ä»¶
2. æ ¹æ®æ¥å£æ–‡æ¡£å®šä¹‰æ•°æ®
3. å°†æ¥å£æ–‡æ¡£æ•°æ®å’Œè¡¨å•å…ƒç´ è¿›è¡Œç»‘å®š



**è½åœ°ä»£ç ï¼š**

```vue
<template>
  <div class="register-container">
    <!-- æ³¨å†Œå†…å®¹ -->
    <div class="register">
     <!-- coding..... -->
     <input type="text" placeholder="è¯·è¾“å…¥ä½ çš„æ‰‹æœºå·" v-model="phone" />
     <!-- coding..... -->
     <input type="text" placeholder="è¯·è¾“å…¥éªŒè¯ç " v-model="code" />
     <!-- coding..... -->
     <input type="text" placeholder="è¯·è¾“å…¥ä½ çš„ç™»å½•å¯†ç " v-model="password" />
     <!-- coding..... -->
     <input type="text" placeholder="è¯·è¾“å…¥ç¡®è®¤å¯†ç " v-model="re_password" />
     <!-- coding..... -->
     <input name="m1" type="checkbox" v-model="isAgree" />
     <!-- coding..... -->
    </div>

    <!-- åº•éƒ¨ -->
    <div class="copyright">
     <!-- coding..... -->
    </div>
  </div>
</template>

<script>
export default {
  name: 'VRegister',
  data() {
    return {
      phone: '', // æ‰‹æœºå·
      code: '', // éªŒè¯ç 
      password: '', // å¯†ç 
      re_password: '', // ç¡®è®¤å¯†ç 
      isAgree: false // æ˜¯å¦åŒæ„åè®®
    }
  }
}
</script>
```







## 6. æ³¨å†Œ-è·å–éªŒè¯ç 



**æ€è·¯åˆ†æï¼š**



å½“ç”¨æˆ·è¾“å…¥æ‰‹æœºå·åï¼Œç‚¹å‡»éªŒè¯ç ï¼Œéœ€è¦è°ƒç”¨æ¥å£ï¼Œè·å–åˆ°éªŒè¯ç 



æ­£å¸¸æƒ…å†µä¸‹ï¼šæ¥å£ä¼šç»™è¿›è¡Œæç¤ºï¼Œæ‰‹æœºä¹Ÿä¼šæ”¶åˆ°ä¹Ÿèƒ½æ”¶åˆ°éªŒè¯ç ï¼Œ

ä½†æ˜¯å› ä¸ºåç«¯åŸå› ï¼Œæ‰‹æœºå¹¶ä¸èƒ½æ”¶åˆ°éªŒè¯ç ï¼Œåç«¯å°†éªŒè¯ç é€šè¿‡æ¥å£è¿›è¡Œè¿”å›äº†ï¼Œ

å› æ­¤ç”¨æˆ·è¾“å…¥æ‰‹æœºå·åï¼Œç‚¹å‡»éªŒè¯ç ï¼Œè°ƒç”¨æ¥å£ï¼Œå°±èƒ½è·å–åˆ°éªŒè¯ç 



**å®ç°æ­¥éª¤ï¼š**



1. å°è£…è·å–éªŒè¯ç çš„ `API`
2. è¾“å…¥æ‰‹æœºå·ï¼Œç”¨æˆ·ç‚¹å‡»è·å–éªŒè¯ç æŒ‰é’®ï¼Œè°ƒç”¨ API



**è½åœ°ä»£ç ï¼š**



1. å°è£…è·å–éªŒè¯ç çš„ `API`

   ```js
   // å¯¼å…¥å°è£…çš„ç½‘ç»œè¯·æ±‚å·¥å…· request.js
   import request from '@/utils/request'
   
   /**
    * @description æ­¤å‡½æ•°ä¸“é—¨ç”¨äºæ ¹æ®æ‰‹æœºå·è·å–éªŒè¯ç 
    * @param { string } phone æ‰‹æœºå·
    * @returns Promise
    */
   export const reqGetCode = (phone) => request.get(`/api/user/passport/sendCode/${phone}`)
   
   ```

   

2. è¾“å…¥æ‰‹æœºå·ï¼Œç”¨æˆ·ç‚¹å‡»è·å–éªŒè¯ç æŒ‰é’®ï¼Œè°ƒç”¨ API

   ```vue
   <template>	
     <!-- -->	
     <button class="getcode" @click="getCode">è·å–éªŒè¯ç </button>
     <!-- -->	
   </template>
   
   <script>
     import { reqGetCode } from '@/api/register'
     // coding......
     methods: {
       // è·å–éªŒè¯ç 
       async getCode() {
         // è°ƒç”¨æ¥å£è·å–éªŒè¯ç 
         const res = await reqGetCode(this.phone)
   
         // åˆ¤æ–­ä¸šåŠ¡é€»è¾‘æ˜¯å¦æˆåŠŸ
         if (res.code === 200) {
           this.$message.success('éªŒè¯ç è·å–æˆåŠŸ')
           this.code = res.data
         } else {
           this.$message.warning(res.message)
         }
       }
     }
   </script>
   ```







## 7. æ³¨å†Œ-å®Œæˆæ³¨å†Œ



**æ€è·¯åˆ†æï¼š**



åœ¨è·å–åˆ°éªŒè¯ç åï¼Œç”¨æˆ·è¾“å…¥å¯†ç ç­‰ï¼Œè°ƒç”¨æ¥å£ï¼Œè¿›è¡Œæ³¨å†Œå³å¯



**å®ç°æ­¥éª¤ï¼š**



1. å°è£…æ³¨å†Œçš„ `API`
2. è¾“å…¥å¯†ç ç­‰ä¿¡æ¯ï¼Œç‚¹å‡»ç«‹å³æ³¨å†Œï¼Œè°ƒç”¨æ¥å£ `API`



**è½åœ°ä»£ç ï¼š**



1. å°è£…æ³¨å†Œçš„ `API`

   ```js
   /**
    * @description æ­¤å‡½æ•°ä¸“é—¨ç”¨äºæ³¨å†Œ
    * @param {*} params phone code password
    * @returns Promise
    */
   export const reqRegister = (params) => request.post('/api/user/passport/register', params)
   ```

   

2. è¾“å…¥å¯†ç ç­‰ä¿¡æ¯ï¼Œç‚¹å‡»ç«‹å³æ³¨å†Œï¼Œè°ƒç”¨æ¥å£ `API`

   ```vue
   <template>	
       <!-- -->	
      	<button @click="register">å®Œæˆæ³¨å†Œ</button>
       <!-- -->	
   </template>
   
   <script>
     import { reqGetCode, reqRegister } from '@/api/register'
   
     methods:{
       // ç”¨æˆ·æ³¨å†Œ
       async register() {
         // è·å–ç”¨æˆ·è¾“å…¥
         const { phone, code, password } = this
         // è¯·æ±‚æ³¨å†Œ(æ³¨æ„æ­¤å¤„ä¼ é€’çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡)
         const res = await reqRegister({ phone, code, password })
         if (res.code === 200) {
           this.$message.success('æ³¨å†ŒæˆåŠŸï¼')
         } else {
           this.$message.warning(res.message)
         }
       }
     }
   </script>
   ```







## 8. ç™»å½•-å®Œæˆç™»å½•åŠŸèƒ½



**æ€è·¯åˆ†æï¼š**



å‡†å¤‡ç™»å½•çš„é™æ€ç»“æ„

è¿›è¡Œç™»å½•æ“ä½œï¼Œéœ€è¦å‘èµ·è¯·æ±‚ï¼Œå‡†å¤‡æ¥å£æ–‡æ¡£ï¼Œå°è£…ç™»å½•çš„æ¥å£ `API`

åœ¨ç™»å½•çš„ `data` ä¸­å£°æ˜æ‰‹æœºå·å’Œå¯†ç æ•°æ®ï¼ŒåŒæ—¶å’Œè¡¨å•è¿›è¡Œç»‘å®š

ç‚¹å‡»ç™»å½•ï¼Œè°ƒç”¨ç™»å½•çš„ `API` å³å¯



**å®ç°æ­¥éª¤ï¼š**



1. å‡†å¤‡ç™»å½•çš„é™æ€ç»“æ„
2. åœ¨ `data` ä¸­å£°æ˜çŠ¶æ€ï¼ŒåŒæ—¶å’Œ è¡¨å•å…ƒç´ è¿›è¡Œç»‘å®š
3. å°è£…ç™»å½•çš„ `API` æ¥å£
4. ç‚¹å‡»ç™»å½•ï¼Œè°ƒç”¨ `API` æ¥å£



**è½åœ°ä»£ç ï¼š**



1. å°è£…ç™»å½•çš„ `api`

   ```js
   // å¯¼å…¥å°è£…çš„ç½‘ç»œè¯·æ±‚å·¥å…· request.js
   import request from '@/utils/request'
   
   /**
    * @description è¯¥è¯·æ±‚ç™»å½•
    * @param {*} params phoneï¼Œpassword
    * @returns
    */
   export const reqLogin = (params) => request.post('/api/user/passport/login', params)
   
   ```

   

2. ç‚¹å‡»ç™»å½•ï¼Œè°ƒç”¨ `API`

   ```vue
   <template>
     <div class="login-container">
       <!-- ç™»å½• -->
       <div class="login-wrap">
         <div class="login">
           <div class="loginform">
             <div class="content">
               <form>
                 <div class="input-text clearFix">
                   <span></span>
                   <input type="text" placeholder="é‚®ç®±/ç”¨æˆ·å/æ‰‹æœºå·" v-model="phone" />
                 </div>
                 <div class="input-text clearFix">
                   <span class="pwd"></span>
                   <input type="text" placeholder="è¯·è¾“å…¥å¯†ç " v-model="password" />
                 </div>
                 <button class="btn" @click.prevent="login">ç™»&nbsp;&nbsp;å½•</button>
               </form>
               <div class="call clearFix">
                 <router-link class="register" to="/register">ç«‹å³æ³¨å†Œ</router-link>
               </div>
             </div>
           </div>
         </div>
       </div>
       <!-- åº•éƒ¨ -->
       <div class="copyright">
         <ul>
           <li>å…³äºæˆ‘ä»¬</li>
           <li>è”ç³»æˆ‘ä»¬</li>
           <li>è”ç³»å®¢æœ</li>
           <li>å•†å®¶å…¥é©»</li>
           <li>è¥é”€ä¸­å¿ƒ</li>
           <li>æ‰‹æœºå°šå“æ±‡</li>
           <li>é”€å”®è”ç›Ÿ</li>
           <li>å°šå“æ±‡ç¤¾åŒº</li>
         </ul>
         <div class="address">åœ°å€ï¼šåŒ—äº¬å¸‚æ˜Œå¹³åŒºå®ç¦ç§‘æŠ€å›­ç»¼åˆæ¥¼6å±‚</div>
         <div class="beian">äº¬ICPå¤‡19006430å·</div>
       </div>
     </div>
   </template>
   
   <script>
   import { reqLogin } from '@/api/login'
   
   export default {
     name: 'VLogin',
     data() {
       return {
         phone: '', // æ‰‹æœºå·
         password: '' // å¯†ç 
       }
     },
     methods: {
       async login() {
         // è·å–æ‰‹æœºå·ã€å¯†ç 
         const { phone, password } = this
         // å‘è¯·æ±‚ç™»å½•
         const result = await reqLogin({ phone, password })
   
         // åˆ¤æ–­ä¸šåŠ¡é€»è¾‘æ˜¯å¦æˆåŠŸ
         if (result.code === 200) {
           // this.$message.success('ç™»å½•æˆåŠŸ')
           console.log('æˆåŠŸ', result)
         } else {
           // this.$message.warning(result.message)
           console.log('å¤±è´¥', result)
         }
       }
     }
   }
   </script>
   
   ```








## 9. ç™»å½•-å¯¹ token çš„ç†è§£ï¼ˆé‡è¦ï¼‰



1. åªæœ‰ç™»å½•æ˜¯æˆåŠŸçš„ï¼ŒæœåŠ¡å™¨æ‰ä¼šä¸ºè¯¥ç”¨æˆ·ç”Ÿæˆä¸€ä¸ª`token`ã€‚

2. `token`æ˜¯ç”¨æˆ·çš„çœŸæ­£æ ‡è¯†ï¼Œæ ¹æ®`token`ï¼Œå¯ä»¥å»æœåŠ¡å™¨é‚£æŸ¥è¯¢åˆ°è¯¥ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯ã€‚

3. æµè§ˆå™¨ç«¯éœ€è¦ä¿å­˜ä¸€ä»½`token`ï¼Œè€Œä¸”æ— è®ºå­˜åœ¨å“ªé‡Œï¼Œä½†æ¨è â€”â€” `localStorage`ä¸­ã€‚

   > ä¸ºä»€ä¹ˆï¼Ÿ â€”â€” ä¸ºäº†åšè‡ªåŠ¨ç™»å½•ï¼ˆç†è§£ï¼šé‡å¼€æµè§ˆå™¨åï¼Œä¾ç„¶æ˜¯ç™»å½•çš„çŠ¶æ€ï¼‰

4. <span style="color:red">æˆ‘ä»¬çš„æœåŠ¡å™¨åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œä¼šè¿”å›ç»™æˆ‘ä»¬ï¼šç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·çœŸå®å§“åã€`token`ï¼Œæˆ‘ä»¬åªå­˜`token`ã€‚</span>

   > ä¸ºä»€ä¹ˆï¼Ÿ â€”â€” æ ¹æ®`token`å¯ä»¥æ‰¾æœåŠ¡å™¨è·å–åˆ°æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯ã€‚
   >
   > å¯¹äºä¸€èˆ¬çš„æœåŠ¡å™¨æ¥è¯´ï¼Œç™»å½•æˆåŠŸåä¸ä¼šç»™ä»»ä½•å¤šä½™çš„ä¿¡æ¯ï¼Œåªç»™ä¸€ä¸ª`token`ã€‚

5. è‹¥ä¸å…è®¸å¤šç«¯ç™»å½•ï¼Œåˆ™æœåŠ¡å™¨è¦åœ¨ç”¨æˆ·ç™»å½•åï¼ŒæŠŠä¹‹å‰çš„`token`é”€æ¯ï¼Œå†ç”Ÿæˆä¸€ä¸ªæ–°çš„`token`ã€‚

   > è¿™ä¸ªå¾—çœ‹å…·ä½“éœ€æ±‚ï¼Œç›®å‰æˆ‘ä»¬çš„å°šå“æ±‡æœåŠ¡å™¨å…è®¸å¤šç«¯ç™»å½•ã€‚

6. `token`ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆçš„ï¼Œä¸€æ—¦åˆ°äº†è¿‡æœŸæ—¶é—´ï¼ŒæœåŠ¡å™¨å°±è‡ªåŠ¨é”€æ¯è¯¥`token`äº†ã€‚

7. è‹¥ç”¨æˆ·ä¸»åŠ¨è§¦å‘é€€å‡ºç™»å½•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šé”€æ¯è¯¥ç”¨æˆ·çš„`token`ã€‚









## 10. ç™»å½•-token æŒä¹…åŒ–å­˜å‚¨



**æ€è·¯åˆ†æï¼š**



åœ¨ç™»å½•åï¼Œéœ€è¦å°† token å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½•å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ° ï¼Ÿ `localStorage`

åœ¨ä»€ä¹ˆæ—¶å€™è¿›è¡Œå­˜å‚¨å‘¢ ï¼Ÿåœ¨ç™»å½•æˆåŠŸåç«¯è¿”å›æ•°æ®ä»¥åè¿›è¡Œæ‰§è¡Œ

å‘é€è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦ tokenï¼Œåœ¨å“ªé‡Œè®¾ç½®ï¼Ÿ åœ¨ è¯·æ±‚æ‹¦æˆªå™¨ä¸­è¿›è¡Œå¤„ç†



**å®ç°æ­¥éª¤ï¼š**



1. åœ¨`src/utils/auth.js`è¿½åŠ å­˜å‚¨ã€è·å–æœ¬åœ°æ•°æ®çš„æ–¹æ³•
2. `Login`ç»„ä»¶ä¸­ï¼Œç™»å½•æˆåŠŸåï¼Œå°†`token`å­˜å…¥`localStorage`ä¸­
3. ä¿®æ”¹`src/api/ajax.js`æ¯æ¬¡è¯·æ±‚ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯å¦æœ‰tokenï¼Œè‹¥æœ‰å°±æºå¸¦



**è½åœ°ä»£ç ï¼š**



1. åœ¨`src/utils/auth.js`è¿½åŠ å­˜å‚¨ã€è·å–æœ¬åœ°æ•°æ®çš„æ–¹æ³•

   ```js
   // å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°
   export function saveToken(token) {
     localStorage.setItem('token', token)
   }
   
   // ä»æœ¬åœ°å­˜å‚¨ä¸­è·å–æ•°æ®
   export function getToken() {
     return localStorage.getItem('token')
   }
   
   ```

   

2. `Login`ç»„ä»¶ä¸­ï¼Œç™»å½•æˆåŠŸåï¼Œå°†`token`å­˜å…¥`localStorage`ä¸­

   ```js
   methods: {
     async login() {
       // è·å–æ‰‹æœºå·ã€å¯†ç 
       const { phone, password } = this
       // å‘è¯·æ±‚ç™»å½•
       const result = await reqLogin({ phone, password })
   
       // åˆ¤æ–­ä¸šåŠ¡é€»è¾‘æ˜¯å¦æˆåŠŸ
       if (result.code === 200) {
         // tokenå­˜å…¥æœ¬åœ°
         saveToken(result.data.token)
         // è‹¥ç™»å½•æˆåŠŸï¼Œåˆ™æç¤º
         this.$message.success('ç™»å½•æˆåŠŸï¼')
         // è·³è½¬ä¸»é¡µ
         this.$router.push('/home')
       } else {
         this.$message.warning(result.message)
       }
     }
   }
   ```

   

3. ä¿®æ”¹`src/api/ajax.js`æ¯æ¬¡è¯·æ±‚ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯å¦æœ‰tokenï¼Œè‹¥æœ‰å°±æºå¸¦

   ```js
   // æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
   request.interceptors.request.use(
     (config) => {
       nprogress.start()
   
       // ä»æœ¬åœ°å­˜å‚¨ä¸­è·å–åˆ° token
       const token = getToken()
   
       // å¦‚æœ token å­˜åœ¨ï¼Œè¯æ˜ç”¨æˆ·æˆåŠŸç™»å½•è¿‡
       if (token) {
         config.headers.token = token
       }
   
       config.headers.userTempId = getUserTempId()
       return config
     },
     (error) => {
       return Promise.reject(error)
     }
   )
   
   ```







## 11. ç™»å½•-è·å–ç”¨æˆ·ä¿¡æ¯å­˜å…¥vuex



**æ€è·¯åˆ†æï¼š**



ç”¨æˆ·çš„ä¿¡æ¯ï¼Œéœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­è¿›è¡Œä½¿ç”¨

å› æ­¤æˆ‘ä»¬æ ¹æ® `token` è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå­˜åœ¨`vuex`ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–ç»„ä»¶ä½¿ç”¨



**å®ç°æ­¥éª¤ï¼š**



1. ç¼–å†™æ¥å£ `API` è¯·æ±‚å‡½æ•°ï¼Œæ ¹æ® `token` è·å–ç”¨æˆ·ä¿¡æ¯
2. åœ¨ `src/store/modules/user.js` ä¸­ï¼Œåˆ›å»º `actions`ã€`mutations` æ“ä½œæ•°æ®
3. åœ¨`Login`ç»„ä»¶ä¸­ï¼Œç™»å½•æˆåŠŸåï¼Œ`dispatch`ä¸€ä¸ª`getUserInfo`è·å–ç”¨æˆ·ä¿¡æ¯



**è½åœ°ä»£ç ï¼š**



1. ç¼–å†™æ¥å£ `API` è¯·æ±‚å‡½æ•°ï¼Œæ ¹æ® `token` è·å–ç”¨æˆ·ä¿¡æ¯

   ```js
   // å¯¼å…¥å°è£…çš„ç½‘ç»œè¯·æ±‚å·¥å…· request.js
   import request from '@/utils/request'
   
   /**
    * @description ä¸“é—¨ç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯
    * @returns
    */
   export const reqUserInfo = () => request.get('/api/user/passport/auth/getUserInfo')
   
   ```

   

2. åœ¨ `src/store/modules/user.js` ä¸­ï¼Œåˆ›å»º `actions`ã€`mutations` æ“ä½œæ•°æ®

   ```js
   import { reqUserInfo } from '@/api/user'
   import { Message } from 'element-ui'
   
   const state = {
     userInfo: {} // ç”¨æˆ·æ•°æ®
   }
   
   const getters = {}
   
   const mutations = {}
   
   const actions = {
     async getUserInfo({ commit }) {
       // å‘é€è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯
       const res = await reqUserInfo()
       // åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ
       if (res.code === 200) {
         commit('SAVE_USER_INFO', res.data)
       } else {
         Message.warning(res.message)
       }
     }
   }
   
   export default {
     namespaced: true,
     state,
     getters,
     mutations,
     actions
   }
   
   ```

   

3. åœ¨`Login`ç»„ä»¶ä¸­ï¼Œç™»å½•æˆåŠŸåï¼Œ`dispatch`ä¸€ä¸ª`getUserInfo`è·å–ç”¨æˆ·ä¿¡æ¯

   ```js
   methods: {
     async login() {
       // è·å–æ‰‹æœºå·ã€å¯†ç 
       const { phone, password } = this
       // å‘è¯·æ±‚ç™»å½•
       const result = await reqLogin({ phone, password })
   
       // åˆ¤æ–­ä¸šåŠ¡é€»è¾‘æ˜¯å¦æˆåŠŸ
       if (result.code === 200) {
         // tokenå­˜å…¥æœ¬åœ°
         saveToken(result.data.token)
         // è‹¥ç™»å½•æˆåŠŸï¼Œåˆ™æç¤º
         this.$message.success('ç™»å½•æˆåŠŸï¼')
         // è·³è½¬ä¸»é¡µ
         this.$router.push('/home')
         // è·å–ç”¨æˆ·ä¿¡æ¯
         this.$store.dispatch('user/getUserInfo')
       } else {
         this.$message.warning(result.message)
       }
     }
   }
   ```










## 12. ç”¨æˆ·ä¿¡æ¯å¦‚ä½•ä¸ä¸¢å¤±



**æ€è·¯åˆ†æï¼š**



åœ¨ç™»å½•åï¼Œè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥åˆ° Vuex ä¸­ï¼Œä½†æ˜¯åˆ·æ–°åå¯¼è‡´`vuex`ä¸­çš„ç”¨æˆ·ä¿¡æ¯ä¸¢å¤±ã€‚

è¿™æ˜¯å› ä¸ºï¼š

1. `Vuex` è„±ç¦»ç»„ä»¶ï¼Œåœ¨å°†æ•°æ®å­˜å‚¨åˆ° Vuex åï¼Œæ•°æ®ä¼šä¸€ç›´å­˜å‚¨åœ¨ï¼Œä¸ä¼šéšç€ç»„ä»¶é”€æ¯è€Œä¸¢å¤±
2. é¡µé¢åˆ·æ–°ï¼Œç­‰äºé‡æ–°åŠ è½½äº†æ•´ä¸ªåº”ç”¨ï¼ŒåŒ…æ‹¬ `Vuex` ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥ `Vuex` æ•°æ®ä¼šé”€æ¯





å¦‚ä½•è§£å†³åˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±çš„é—®é¢˜å‘¢ï¼Ÿ



1. æ–¹æ³• 1ï¼šå­˜å…¥`localStorage`ä¸­ã€‚

   > å¯ä»¥å®ç°ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºå­˜çš„ä¸€ç‚¹æ„ä¹‰éƒ½æ²¡æœ‰ï¼Œ
   >
   > 
   >
   > ä¾‹å¦‚ï¼š
   >
   > â€‹	æ‰‹æœºç«¯ï¼šå¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œäº†æ›´æ”¹
   >
   > â€‹	PC    ç«¯ï¼šåˆ·æ–°é¡µé¢ã€é‡å¼€æµè§ˆå™¨å
   >
   > 
   >
   > â€‹	 è¿™æ—¶å€™å­˜å‚¨åˆ°æœ¬åœ°çš„ç”¨æˆ·ä¿¡æ¯æ˜¯æ— æ•ˆçš„ï¼Œè¿˜å¾—é€šè¿‡`token` é‡æ–°è¯·æ±‚ç”¨æˆ·ä¿¡æ¯ã€‚è¿™æ—¶å€™å°±å‡ºç°äº†ä¸‹é¢çš„é—®é¢˜

   

2. æ–¹æ³• 2ï¼šåˆ†åˆ«åœ¨ï¼š`Search`ç»„ä»¶ã€`Cart`ç»„ä»¶ã€`Detail`ç»„ä»¶ç­‰ç­‰ï¼Œä¸­`dispatch('getUserInfo')`ã€‚

   > å¯ä»¥å®ç°ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœç»„ä»¶å¾ˆå¤šçš„è¯ï¼Œå¤ªéº»çƒ¦äº†ï¼
   >
   > 
   >
   > ä¾‹å¦‚ï¼š
   >
   > â€‹	å¤šä¸ªç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­è°ƒç”¨ dispatch è·å–ç”¨æˆ·ä¿¡æ¯

   

3. æ–¹æ³•  3ï¼š`App`ç»„ä»¶ä¸­`dispatch('getUserInfo')`ã€‚

   > å¯ä»¥å®ç°ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ï¼Œä¼šæœ‰ä¸¥é‡bugï¼Œåœ¨åˆæ¬¡ç™»å½•çš„æ—¶å€™ï¼Œæ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ã€‚
   >
   > 
   >
   > ä¾‹å¦‚ï¼š
   >
   > â€‹	App.vue æ˜¯æ ¹ç»„ä»¶ï¼Œåªä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œä¸€æ¬¡ï¼Œé¡µé¢è·³è½¬ï¼Œä¸ä¼šé‡æ–°æ‰§è¡Œ
   >
   > â€‹	ä½†æ˜¯ç”¨æˆ·ç™»å½•åï¼Œç›´æ¥è·³è½¬åˆ° `/home`ï¼Œè¿™æ—¶å€™ï¼Œ`App.vue` å°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œå°±ä¸ä¼šè·å–ç”¨æˆ·ä¿¡æ¯
   >
   > â€‹    è¿™æ—¶å€™å°±éœ€è¦ åœ¨ ç™»å½•çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ `dispatch`ï¼Œåˆ·æ–°çš„æ—¶å€™åœ¨ `App.vue` è°ƒç”¨ä¸€æ¬¡

   

4. æ–¹æ³•  4ï¼šé `å¯¼èˆªå®ˆå«`å»ç»´æŠ¤ç”¨æˆ·ä¿¡æ¯ã€‚

   > åœ¨Vueé¡¹ç›®ä¸­ï¼Œè¾ƒä¸ºå‘¨å…¨çš„åšæ³•æ˜¯
   >
   > 1. `token`å­˜å…¥`localStorage`ï¼Œæ ¹æ®`token`è·å–çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥`vuex`
   > 2. æ¯æ¬¡åˆ·æ–°é¡µé¢ã€é‡å¼€æµè§ˆå™¨æ—¶ï¼Œé `å¯¼èˆªå®ˆå«`å»ç»´æŠ¤ç”¨æˆ·ä¿¡æ¯ã€‚









## 13. å¯¼èˆªå®ˆå«



### 13.1 å¯¼èˆªå®ˆå«çš„æ¦‚å¿µ



**æ€è·¯åˆ†æï¼š**



1. ä»€ä¹ˆæ˜¯å¯¼èˆªå®ˆå«

   åœ¨è¿›å…¥è·¯ç”±æˆ–è€…ç¦»å¼€è·¯ç”±çš„æ—¶å€™ï¼Œåˆ©ç”¨ VueRouter æä¾›çš„é’©å­å‡½æ•°ï¼Œå¯¹è¿›å…¥å’Œç¦»å¼€çš„çŠ¶æ€è¿›è¡Œç›‘å¬ï¼Œä»è€Œæ‰§è¡Œè¿½åŠ ç‰¹æ®Šé€»è¾‘ï¼ˆè·¯ç”±é‰´æƒã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰

   

2. å¯¼èˆªå®ˆå«çš„åˆ†ç±»ï¼š

   

   - <strong style="color:red">å…¨å±€å®ˆå«ï¼ˆå¾ˆå¸¸ç”¨ï¼‰====> æ¥¼ä¸‹çš„ä¿å®‰å¤§çˆ·</strong >
   - è·¯ç”±ç‹¬äº«å®ˆå« =========> å°šç¡…è°·æ¥¼å±‚çš„å€¼ç­è€å¸ˆ
   - ç»„ä»¶å†…å®ˆå« ===========> ç­çº§é‡Œçš„è€å¸ˆ

   

3. æˆ‘ä»¬çš„é¡¹ç›®ä¸ºä»€ä¹ˆä½¿ç”¨å¯¼èˆªå®ˆå«ï¼Ÿ

   - æ¯æ¬¡è·¯ç”±è·³è½¬ã€åˆ·æ–°é¡µé¢æ—¶ï¼Œè¿½åŠ ç‰¹æ®Šé€»è¾‘ï¼Œä¾‹å¦‚ï¼šè·¯ç”±é‰´æƒã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰

   - å¯¹æŸäº›æ•æ„Ÿè·¯ç”±åšå‡ºè®¿é—®é™åˆ¶ã€‚

   



### 13.2 å¯¼èˆªå®ˆå«çŸ¥è¯†ç‚¹



**æ€è·¯åˆ†æï¼š**



1. <strong style="color:red">å…¨å±€å®ˆå«(å¾ˆå¸¸ç”¨)</strong >

   ```js
   const router = new VueRouter({ ... })
   
   // to å»å“ªé‡Œ
   // from ä»å“ªæ¥
   // next å»å“ªé‡Œ
   router.beforeEach((to, from, next) => {
     // ...
   })
   
   router.afterEach((to, from) => {
     // ...
   })
   ```

   

2. è·¯ç”±ç‹¬äº«å®ˆå«

   ```js
   const router = new VueRouter({
     routes: [
       {
         path: '/foo',
         component: Foo,
         beforeEnter: (to, from, next) => {
           // ...
         }
       }
     ]
   })
   ```

   

3. ç»„ä»¶å†…å®ˆå«

   ```js
   const Foo = {
     template: `...`,
     beforeRouteEnter(to, from, next) {
       // åœ¨æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢« confirm å‰è°ƒç”¨
       // ä¸ï¼èƒ½ï¼è·å–ç»„ä»¶å®ä¾‹ `this`
       // å› ä¸ºå½“å®ˆå«æ‰§è¡Œå‰ï¼Œç»„ä»¶å®ä¾‹è¿˜æ²¡è¢«åˆ›å»º
     },
     beforeRouteUpdate(to, from, next) {
       // åœ¨å½“å‰è·¯ç”±æ”¹å˜ï¼Œä½†æ˜¯è¯¥ç»„ä»¶è¢«å¤ç”¨æ—¶è°ƒç”¨
       // ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰åŠ¨æ€å‚æ•°çš„è·¯å¾„ /foo/:idï¼Œåœ¨ /foo/1 å’Œ /foo/2 ä¹‹é—´è·³è½¬çš„æ—¶å€™ï¼Œ
       // ç”±äºä¼šæ¸²æŸ“åŒæ ·çš„ Foo ç»„ä»¶ï¼Œå› æ­¤ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚è€Œè¿™ä¸ªé’©å­å°±ä¼šåœ¨è¿™ä¸ªæƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚
       // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
     },
     beforeRouteLeave(to, from, next) {
       // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨
       // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
     }
   }
   ```



> ğŸ¯  æ³¨æ„ï¼š**`å¯¼èˆªå®ˆå«ä¸€å®šè¦æœ‰å‡ºå£ï¼`**
>
> 
>
> 1. å‡ºå£ï¼Œå¯ä»¥ç†è§£ä¸ºæ”¾è¡Œï¼Œæ˜¯å¦å…è®¸è·³è½¬è¿›æŸä¸ªè·¯ç”±
> 2. é€šè¿‡ `next()` è¿›è¡Œæ”¾è¡Œ
>    - next()  // é’©å­æ‰§è¡Œå®Œäº†ï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªè·¯ç”±
>    - next(false)  // ä¸­æ–­å½“å‰è·¯ç”±è·³è½¬è¡Œä¸º
>    - next('/') ã€next({ path: '/' }) // æ ¹æ®è·¯ç”±è·³è½¬æ¡ä»¶æ¥è¿›å…¥ç‰¹å®šçš„è·¯ç”±ï¼Œè¿›å…¥ä¸€ä¸ªæ–°çš„å¯¼èˆª
>    - next(error)  // ä¸­æ–­è·¯ç”±ï¼Œé”™è¯¯ä¼šè¢«ä¼ é€’ç»™ router.onError() æ³¨å†Œè¿‡çš„å›è°ƒä¸­



**è½åœ°ä»£ç ï¼š**

```js
import Vue from 'vue'
import VueRouter from 'vue-router'

// å¯¼å…¥ç»„ä»¶
import VDashboard from '@/views/Dashboard'
import Layout from '@/views/Layout'
import VMarket from '@/views/Market'
import VBicenter from '@/views/Bicenter'
import VSetting from '@/views/Setting'

Vue.use(VueRouter)

// è·¯ç”±è§„åˆ™é…ç½®
const routes = [
    // ......
]

const router = new VueRouter({
  routes
})

// å…¨å±€å¯¼èˆªå®ˆå«
// router.beforeEach((to, from, next) => {
//   next() // å¯ä»¥
// })

// router.beforeEach((to, from, next) => {
//   next('/') // ä¸èƒ½ç›´æ¥å†™ä¸€ä¸ªè·¯å¾„ï¼Œä¼šé€ æˆæ­»å¾ªç¯
// })

// router.beforeEach((to, from, next) => {
//   if (to.path === '/market') {
//     next(false) // ä¸­æ–­å½“å‰è·¯ç”±è·³è½¬è¡Œä¸º
//   } else {
//     next()
//   }
// })

router.beforeEach((to, from, next) => {
  if (to.path === '/market') {
    next(new Error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯')) // ä¸­æ–­è·¯ç”±ï¼Œé”™è¯¯ä¼šè¢«ä¼ é€’ç»™ router.onError() æ³¨å†Œè¿‡çš„å›è°ƒä¸­
  } else {
    next()
  }
})

router.onError((err) => {
  console.log(err)
})

export default router

```







### 13.3 å¯¼èˆªå®ˆå«å°æ¡ˆä¾‹



**æ€è·¯åˆ†æï¼š**



å¦‚æœæ˜¯ vipï¼Œå¯ä»¥è®¿é—®ä»»æ„è·¯ç”±

å¦‚æœä¸æ˜¯ vipï¼Œåªå…è®¸è®¿é—® dashborad è·¯ç”±



**è½åœ°ä»£ç ï¼š**

```js
import Vue from 'vue'
import VueRouter from 'vue-router'

// å¯¼å…¥ç»„ä»¶
import VDashboard from '@/views/Dashboard'
import Layout from '@/views/Layout'
import VMarket from '@/views/Market'
import VBicenter from '@/views/Bicenter'
import VSetting from '@/views/Setting'

Vue.use(VueRouter)

// è·¯ç”±è§„åˆ™é…ç½®
const routes = [
  {
    path: '/',
    redirect: '/dashboard'
  },

  {
    path: '/dashboard',
    component: Layout,
    children: [
      {
        path: '',
        component: VDashboard
      }
    ]
  },

  {
    path: '/market',
    component: Layout,
    children: [
      {
        path: '',
        component: VMarket
      }
    ]
  },
  {
    path: '/bicenter',
    component: Layout,
    children: [
      {
        path: '',
        component: VBicenter
      }
    ]
  },
  {
    path: '/setting',
    component: Layout,
    children: [
      {
        path: '',
        component: VSetting
      }
    ]
  }
]

const router = new VueRouter({
  routes
})

// ç”¨äºæ ‡è¯†æ˜¯å¦ä¸º vip
const isVIP = true

// è®¾è®¡ä¸€ä¸ªé‰´æƒåå•
const authPath = ['/market', '/bicenter', '/setting']

// å…¨å±€å¯¼èˆªå®ˆå«
router.beforeEach((to, from, next) => {
  console.log(to)
  if (isVIP) {
    // å¦‚æœæ˜¯ vip ï¼Œå¯ä»¥è®¿é—®ä»»åŠ¡è·¯ç”±
    next()
  } else {
    if (authPath.includes(to.path)) {
      alert('è¯·å……å€¼ä¼šå‘˜')
      next('/')
    } else {
      next()
    }
  }
})

export default router

```









## 14. dispatchçš„è¿”å›å€¼



`dispatch` å…·æœ‰è¿”å›å€¼ï¼Œå³ä½¿ç”¨`this.$store.dispatch('xxx')`è§¦å‘ `actions` åè¿”å›å€¼ä¸€ä¸ª`Promise`å®ä¾‹ã€‚

```js
methods: {
  handler() {
    const result = this.$store.dispatch('test/changeNum', 1)
    
    console.log(result) // PromiseÂ {<pending>}
  }
}
```

```js
const state = {
  num: 1
}

const getters = {}

const mutations = {
  updateNum(state, newNum) {
    state.num += newNum
  }
}

const actions = {
  changeNum({ commit, state }, newNum) {
    commit('updateNum', newNum)
  }
}

export default {
  namespaced: true,
  state,
  getters,
  mutations,
  actions
}

```



è¿”å›çš„è¿™ä¸ª`Promise`å®ä¾‹ï¼ŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¦çœ‹`action` å‡½æ•°çš„è¿”å›å€¼ï¼Œè§„åˆ™åŒ`then`æ–¹æ³•ã€‚

```js
methods: {
  handler() {
    this.$store.dispatch('test/changeNum', 1).then(
      (val) => {
        console.log(val)
      },
      (err) => {
        console.log(err)
      }
    )
      
    // ç¬¬äºŒç§å†™æ³•
    // try {
    //   const res = await this.$store.dispatch('test/changeNum', 1)
    //   console.log(res)
    // } catch (error) {
    //   console.log(error)
    // }

    // ç¬¬ä¸‰ç§å†™æ³•
    const res = await this.$store.dispatch('test/changeNum', 1).catch((err) => err)
    console.log(res)
  }
}
```

```js
const actions = {
  changeNum({ commit, state }, newNum) {
    if (state.num === 3) {
      return Promise.reject(new Error('æˆ‘æŠ¥é”™äº†'))
    } else {
      commit('updateNum', newNum)
      return 123456
    }
  }
}
```



